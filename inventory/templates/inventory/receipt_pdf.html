{% load humanize %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Receipt {{ receipt.receipt_number }}</title>
    <style>
        /* Basic CSS for PDF - Adjust as needed */
        @page {
            size: A4;
            margin: 1.5cm; /* Add margins */
        }
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-size: 10pt;
            line-height: 1.4;
            color: #333;
        }
        h1, h2, h3, h4, h5, h6 {
            font-weight: bold;
            margin-bottom: 0.5em;
        }
        h1 { font-size: 18pt; }
        h2 { font-size: 14pt; }
        h5 { font-size: 11pt; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1em;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 6px 8px;
            text-align: left;
            vertical-align: top;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .text-end { text-align: right; }
        .fw-bold { font-weight: bold; }
        .notes {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #eee;
            background-color: #f9f9f9;
            font-size: 9pt;
        }
        .header-info { margin-bottom: 20px; }
        .header-info p { margin: 2px 0; }
        .totals tfoot td { border-top: 2px solid #555; }
        .totals .grand-total { font-size: 12pt; }
    </style>
</head>
<body>

    <h1>Purchase Receipt</h1>
    <hr>

    <div class="header-info">
        <p><strong>Receipt Number:</strong> {{ receipt.receipt_number }}</p>
        <p><strong>Purchase Date:</strong> {{ receipt.purchase_date|date:"F j, Y" }}</p>
        <p><strong>Supplier:</strong> {{ receipt.supplier.name|default:"N/A" }}</p>
        {% if receipt.supplier.address %}
            <p><strong>Supplier Address:</strong> {{ receipt.supplier.address|linebreaksbr }}</p>
        {% endif %}
        <p><strong>Generated By:</strong> {{ request.user.username|default:"System" }} on {% now "F j, Y H:i" %}</p> {# Add generation timestamp #}
    </div>

    <h5>Items Purchased</h5>
    <table class="items">
        <thead>
            <tr>
                <th>Product</th>
                <th class="text-end">Quantity</th>
                <th class="text-end">Unit Price</th>
                <th class="text-end">Line Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in receipt.items.all %}
            <tr>
                <td>{{ item.product.name }} {% if item.product.sku %}({{item.product.sku}}){% endif %}</td>
                <td class="text-end">{{ item.quantity }}</td>
                <td class="text-end">Ush {{ item.unit_price|floatformat:2| intcomma  }}</td>
                <td class="text-end">Ush {% widthratio item.quantity 1 item.unit_price %}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" style="text-align: center; padding: 20px;">No items found on this receipt.</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot class="totals">
           <tr>
               <td colspan="3" class="text-end fw-bold">Total Amount:</td>
               <td class="text-end fw-bold grand-total">Ush {{ receipt.total_amount|floatformat:2| intcomma }}</td>
           </tr>
        </tfoot>
    </table>

    {% if receipt.notes %}
        <div class="notes">
            <h5>Notes</h5>
            <p>{{ receipt.notes|linebreaksbr }}</p>
        </div>
    {% endif %}

</body>
</html>